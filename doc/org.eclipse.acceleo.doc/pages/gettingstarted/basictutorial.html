<!DOCTYPE html>
<html lang="en">
<!--
/********************************************************************************
** Copyright (c) 2012 Obeo.
** All rights reserved. This program and the accompanying materials
** are made available under the terms of the Eclipse Public License v1.0
** which accompanies this distribution, and is available at
** http://www.eclipse.org/legal/epl-v10.html
**
** Contributors:
**    Stephane Begaudeau (Obeo) - initial API and implementation
*********************************************************************************/
-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="St&eacute;phane B&eacute;gaudeau">    

    <!-- IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <link href="../../assets/css/bootstrap.css" rel="stylesheet">
    <link href="../../assets/css/docs.css" rel="stylesheet">
    
    <title>Acceleo</title>
  </head>
  <body>
    <div class="container">
      <header class="jumbotron subhead" id="overview">
        <h1>Basic Tutorial</h1>
        <p class="lead">Your first Acceleo project</p>
        <div class="subnav">
          <ul class="nav nav-pills">
            <li><a href="#introduction">Introduction</a></li>
            <li><a href="#perspective">Acceleo Perspective</a></li>
            <li><a href="#newproject">New Project</a></li>
            <li><a href="#editor">Acceleo Editor</a></li>
            <li><a href="#generator">Generator</a></li>
            <li><a href="#usercode">User Code</a></li>
            <li><a href="#javaservices">Java Services</a></li>
            <li><a href="#userinterface">User Interface</a></li>
          </ul>
        </div>
      </header>
      
      <section id="introduction">
        <div class="page-header">
          <h1>Introduction <small>let's begin.</small></h1>
        </div>
        
        <p>
          The goal of this tutorial is to get you started with Acceleo by helping you create your first generation module.
          For the purpose of this tutorial, we will focus on creating an Acceleo module that generates Java beans from a UML model.
        </p>
        
        <h2>Environment</h2>
        <p>
          In order to realize this tutorial, the recommended environment is composed of:
          <ul>
            <li>Java SE 5, Java SE 6 or Java SE 7</li>
            <li><a href="http://eclipse.org/downloads/">Eclipse Modeling bundle</a></li>
            <li>The latest release of EMF</li>
            <li>The latest release of OCL</li>
            <li>Acceleo 3.3.0</li>
          </ul>
        </p>
        
        <p>
          The latest release of EMF and OCL can be found in the update site of your Eclipse install. This update site should be
          already configured in your Eclipse, for example:
          <ul>
            <li>Eclipse 4.2 Juno: http://download.eclipse.org/releases/juno</li>
            <li>Eclipse 3.7 Indigo: http://download.eclipse.org/releases/indigo</li>
            <li>Eclipse 3.6 Helios: http://download.eclipse.org/releases/helios</li>
          </ul>
        </p>
        
      </section>
      
      <section id="perspective">
        <div class="page-header">
          <h1>Acceleo Perspective <small>use the Acceleo perspective.</small></h1>
        </div>
        <p>
          Using the Acceleo perspective will make things easier when working with Acceleo as it provides dedicated views and
          actions. Furthermore, being on that perspective will promote some menu items so that they are directly accessible
          instead of being nested within others. You can switch to the Acceleo perspective by selecting the Window > Open
          Perspective > Other... menu and selecting Acceleo in the popup that appears then.
        </p>
      </section>
      
      <section id="newproject">
        <div class="page-header">
          <h1>New Project <small>start your code generator.</small></h1>
        </div>
        <p>
          Acceleo Projects are meant to provide you with facilities to write your Acceleo modules. In order to create a new
          Acceleo project, use the menu item File > New > Acceleo Project.
        </p>
        <p>
          Choose the name you want for your project (here, we'll go for the default org.eclipse.acceleo.module.sample), then
          click Next>.
        </p>
        <p>
          This second wizard page allows you to initialize the project by creating one or several Acceleo module files.
        </p>
        <ul>
          <li>Select the folder in which you want to create the new module file.</li>
          <li>Fill in the module name (we'll leave it as generate in this example).</li>
          <li>Select the metamodel from which your generation module will take its types (in this example, UML).</li>
          <li>Finally, choose the metaclass that will be used to generate the file (in this example, Class). This can
          be modified later at any time directly in the module files.</li>
        </ul>
        <p>
          Note: other options are available to initialize the new module with existing content. These will be discussed
          in detail later. You can create more than one module file in this project by using the "Add" button on the left,
          we only need one in this example. Clicking on finish will create the module file(s), and some files automatically
          generated from it (more on these below).
        </p>
      </section>
      
      <section id="editor">
        <div class="page-header">
          <h1>Acceleo Editor <small>time to write the generator.</small></h1>
        </div>
        <p>
          The Acceleo module editor provides the following features:
        </p>
        <ul>
          <li>Syntax highlighting</li>
          <li>Content assistant (ctrl + space)</li>
          <li>Error detection</li>
          <li>Quick fixes (ctrl + shift + 1)</li>
          <li>Dynamic outline</li>
          <li>Quick outline (ctrl + O)</li>
          <li>Code folding</li>
          <li>Open declaration (either with 'ctrl + left click' or 'F3' on selection)</li>
          <li>Search references (ctrl + shift + G)</li>
        </ul>
        <p>
          For more information about the Acceleo syntax, please read the official OMG specification accessible from the
          official MTL Specification.
        </p>
      </section>
      
      <section id="generator">
        <div class="page-header">
          <h1>Generator <small>write the module to generate the Java beans.</small></h1>
        </div>
        <p>
          We would now like to create a bean for each of the classes defined in our sample model. Here is the code for the module file:
        </p>
        <pre>
          [comment encoding = UTF-8 /]
          [module generate('http://www.eclipse.org/uml2/3.0.0/UML')/]
          
          [template public generate(aClass : Class)]
          [file (aClass.name.concat('.java'), false)]
          public class [aClass.name.toUpperFirst()/] {
          [for (p: Property | aClass.attribute) separator('\n')]
              private [p.type.name/] [p.name/];
          [/for]
          
          [for (p: Property | aClass.attribute) separator('\n')]
              public [p.type.name/] get[p.name.toUpperFirst()/]() {
                  return this.[p.name/];
              }
          [/for]
          
          [for (o: Operation | aClass.ownedOperation) separator('\n')]
              public [o.type.name/] [o.name/]() {
                  // TODO should be implemented
              }
          [/for]
          }
          [/file]
          [/template]
        </pre>
        <p>
          As shown below, the content assistant provides choices from the UML metamodel:
        </p>
        <p>
          You can now launch the generation of your Java beans using this generation module but you need an ".uml"
          model as the input. You can create one thanks to the wizards and editor provided by the UML project or you
          can take the one provided in the UML to Java Acceleo example (File -> New -> Example -> Acceleo -> UML to Java).
          In order to do this, you will have to :
        </p>
        <p>
          Right-click on the Acceleo module file (that is, the generate.mtl file) and select Run As > Launch Acceleo Application.
        </p>
        <p>
          The Acceleo launch configuration page opens, and you need to provide it with the sample model and target folder.
        </p>
        <p>
          The resulting java file generated by this module file will look like this:
        </p>
      </section>
      
      <section id="usercode">
        <div class="page-header">
          <h1>User Code <small>supporting modification of the generated code.</small></h1>
        </div>
        <p>
          Acceleo supports two ways of specifying user code blocks in the generated code. User code blocks delimit portions
          of text that are only generated once, and preserved for subsequent generations. This is very useful in order to
          allow users to add code in some areas of the generated files while keeping the rest of the file under the control
          of the generator.
        </p>
        <p>
          The first way of specifying user-code blocks is to use the standard [protected (id)]...[/protected] construct, as
          shown below (we've also added some queries in there to handle the package structure):
        </p>
        <p>
          The above module produces the following code:
        </p>
        <p>
          The second way, which is specific to generators that target the java language, is to add @generated annotations
          on the javadoc of elements that must be generated. Other elements (those that do not have such annotations in
          their javadoc, or in which the annotation has been slightly modified (i.e: @generated NOT or @not-generated ...
          or whatever you fancy)) are considered not to be modified by subsequent generations.
        </p>
        <p>
          If a file contains at least one annotation @generated, the merge of the former java file and the newly generated
          one is delegated to JMerge_. @generated annotations must be added in the javadoc of the relevant java elements.
          They are not JDK5 annotations.
        </p>
        <p>
          In both of these examples, the code located in "protected" areas will never be overriden by subsequent generations,
          be it left as-is or modified by the user outside of the module (directly in the generated file).
        </p>
      </section>
      
      <section id="javaservices">
        <div class="page-header">
          <h1>Java Services <small>call Java method to handle complex operations.</small></h1>
        </div>
        <p>
          We will now add a requirement that java beans should only be generated for Classes that have the Bean stereotype.
          This coud be done through Acceleo alone, but for the purpose of this tutorial we will use a java service (extension
          of the language) in order to check whether the stereotype is present on any given Class. It is possible to initialize
          the content of a new Acceleo module file with content that comes from:
        </p>
        <ul>
          <li>An existing Acceleo module file (a copy of this file is made)</li>
          <li>Some java code that you need to access from your Acceleo templates</li>
        </ul>
        <p>
          We will detail here the second possibility, which makes it possible to execute standard java code from any Acceleo
          template or query. First, create the Java class we'll use as a service in Acceleo.
        </p>
        <ul>
          <li>Right-click the org.eclipse.acceleo.module.sample package in the Package Explorer and select New > Class</li>
          <li>In the popup that appears, change the Package field to org.eclipse.acceleo.module.sample.services and fill in
          the name field, we'll call this java Class UML2Services in this tutorial.</li>
          <li>Finally, paste in the following code for this class:</li>
          <pre>
          package org.eclipse.acceleo.module.sample.services;
          
          import java.util.List;
          
          import org.eclipse.uml2.uml.Class;
          import org.eclipse.uml2.uml.Stereotype;
          
          public class UML2Services {
              public boolean hasStereotype(Class clazz, String stereotypeName) {
                  List<Stereotype> stereotypes = clazz.getAppliedStereotypes();
                  for (Stereotype stereotype : stereotypes) {
                      if (stereotype.getName().equals(stereotypeName)) {
                          return true;
                      }
                  }
                  return false;
              }
          }
          </pre>
        </ul>
        <p>
          Now, what's left is to call this method from Acceleo. The easiest way to do so is to use the provided wizard.
          Right-click the org.eclipse.acceleo.module.sample.services package and select New > Acceleo Module File.
        </p>
        <p>
          In the wizard window, enter the relevant information in the fields : select the UML metamodel URI and change the
          name field to uml2Services. Then, activate the Advanced button in order to gain access to the advanced options.
          Tick the Initialize Contents checkbox and select: Create a Java services wrapper. Finally, browse to find the
          UML2Services java file.
        </p>
        <p>
          This creates a new Acceleo Module file that contains a query (one per java method in your java class) whose role
          is just to delegate its behavior to the java class, thus making it accessible to your templates. This is simply
          achieved thanks to the non-standard "invoke" Acceleo operation.
        </p>
        <p>
          Now to prevent Acceleo from generating files for classes that do not have the Bean stereotype, all that's needed
          is to import the uml2Services module in the generate module and nest the [file] block within an [if] block calling
          this service.
        </p>
        <p>
          We recommend not to have multiple modules with an @main annotation, as it complicates the workflow (you have to
          launch multiple generations to create all needed files). On the contrary, we recommend creating a "main" module
          which role will be to delegate to all of the modules that will create files. Typically, this module will be placed
          alone in its own *.main package.
        </p>
        <p>
          Let's create this launcher for the beans generation. First, right-click the org.eclipse.acceleo.module.sample
          package in the Package Explorer and select New > Acceleo Module File. We will need to change all default information.
          First, append '*/main*' at the end of the parent folder field. Then, give a meaningful name for this module (umlToBeans
          in this example) and set its metamodel appropriately. As we generate on UML, we will also change the root type of
          our generation to *Package* (the root of our UML model). We will also untick This will generate a file and tick
          Create a main annotation in the advanced options.
        </p>
        <p>
          Since this module contains a @main annotation, we will need to export its containing package (so that other Eclipse
          plugins may launch the generation). For this, open the META-INF/MANIFEST.MF file of your project, go to its Runtime
          tab, click Add and select the org.eclipse.acceleo.module.sample.main package. The tab should look like this when you
          are done:
        </p>
        <p>
          Now, paste the following code in your umlToBeans module:
        </p>
        <pre>
          [comment encoding = UTF-8 /]
          [module umlToBeans('http://www.eclipse.org/uml2/3.0.0/UML')/]
          
          [import org::eclipse::acceleo::module::sample::files::generate /]
          
          [template public umlToBeans(aPackage : Package)]
          [comment @main /]
          [for (aClass : Class | aPackage.packagedElement->filter(Class))]
              [aClass.generate()/]
          [/for]
          [/template]
        </pre>
        <p>
          And that's it! you can now launch this main module in order to generate java beans from any UML model. Simply right
          click the umlToBeans.mtl file, select Run As > Launch Acceleo Application and select the model from which to generate
          and the target folder before hitting the *Run* button.
        </p>
      </section>
      
      <section id="userinterface">
        <div class="page-header">
          <h1>User Interface <small>Create an user interface to integrate your generator in Eclipse.</small></h1>
        </div>
        <p>
          Now that your generation modules are ready, you may want to have some wizards to launch the generation from within
          Eclipse. You can use the generated java launcher in a manually coded action, but you can also use the New Acceleo UI
          project wizard. This wizard will create a new Eclipse project which will allow you to launch the generation with a
          right-click action on any appropriate model. First, right click on your Acceleo project (org.eclipse.acceleo.module.sample)
          then select *New > Acceleo UI Launcher Project*.
        </p>
        <p>
          Fill in the desired name for this project, then click next.
        </p>
        <p>
          Select the generator project as referenced project, then click next.
        </p>
        <p>
          Finally, enter the model filename filter (files for which the generation action must be proposed on ricght-clicks,
          *.uml in our example), and the java code for the target folder (leave it as-is to generate the code in the src-gen
          folder of the project containing the right-clicked model).
        </p>
        <p>
          The wizard will create a new plugin with all the necessary code to display a new action for the selected model file
          that will generate code in the specified folder. The screenshot below shows the result of this plugin, a Generate Uml
          To Beans action on the *.uml* files.
        </p>
      </section>
      
      <footer class="footer">
        <p>
          The material in these guides are Copyright (c) 2008, 2012 Obeo. <a href="">Terms and Conditions</a>
        </p>
      </footer>
    </div>
  </body>
</html>
