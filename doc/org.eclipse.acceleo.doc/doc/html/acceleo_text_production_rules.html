<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>Acceleo Text Production Rules</title>
<meta name="authors" content="Laurent Goubet  Laurent Delaigue" />
<link rel="stylesheet" href="../style/acceleo.css" type="text/css" />
</head>
<body>
<div class="document" id="acceleo-text-production-rules">
<h1 class="title">Acceleo Text Production Rules</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Authors:</th>
<td>Laurent Goubet
<br />Laurent Delaigue</td></tr>
<tr><th class="docinfo-name">Contact:</th>
<td><a class="first last reference external" href="mailto:laurent.goubet&#64;obeo.fr">laurent.goubet&#64;obeo.fr</a>
<br /><a class="first last reference external" href="mailto:laurent.delaigue&#64;obeo.fr">laurent.delaigue&#64;obeo.fr</a></td></tr>
</tbody>
</table>
<p>Copyright © 2008, 2010 Obeo™.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id4">Overview</a></li>
<li><a class="reference internal" href="#definitions" id="id5">Definitions</a><ul>
<li><a class="reference internal" href="#examples" id="id6">Examples</a><ul>
<li><a class="reference internal" href="#stand-alone-single-line-blocks" id="id7">Stand-alone single-line blocks</a></li>
<li><a class="reference internal" href="#embedded-single-line-blocks" id="id8">Embedded single-line blocks</a></li>
<li><a class="reference internal" href="#stand-alone-multi-line-blocks" id="id9">Stand-alone multi-line blocks</a></li>
<li><a class="reference internal" href="#embedded-multi-line-blocks" id="id10">Embedded multi-line blocks</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#identifying-body-element-boundaries" id="id11">Identifying Body Element Boundaries</a><ul>
<li><a class="reference internal" href="#block-body" id="id12">Block Body</a></li>
<li><a class="reference internal" href="#static-text" id="id13">Static Text</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rules" id="id14">Rules</a></li>
<li><a class="reference internal" href="#id1" id="id15">Examples</a><ul>
<li><a class="reference internal" href="#blocks" id="id16">Blocks</a><ul>
<li><a class="reference internal" href="#embedded-blocks" id="id17">Embedded Blocks</a></li>
<li><a class="reference internal" href="#id2" id="id18">Stand-alone single-line blocks</a></li>
<li><a class="reference internal" href="#id3" id="id19">Stand-alone multi-line blocks</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#complete-example" id="id20">Complete Example</a></li>
</ul>
</div>
<div class="section" id="overview">
<h1><a class="toc-backref" href="#id4">Overview</a></h1>
<p>This is still a draft and is only provided as information. Though this document
is still missing some formatting and examples, it can be used to get a precise
idea as to how indentation and carriage returns are handled in Acceleo.</p>
</div>
<div class="section" id="definitions">
<h1><a class="toc-backref" href="#id5">Definitions</a></h1>
<p>Text production rules will apply to all body elements.
Each body element can be either stand alone or embedded within other body
elements.
It will be easier to understand text production rules by splitting these body
elements in five main categories : expressions, static text, comments, template
invocation and blocks.</p>
<p>&quot;Blocks&quot; include template, for, if, let, protected area, file, trace and macro
blocks.
A block will be considered «&nbsp;stand-alone&nbsp;» if it is either one of:</p>
<ul class="simple">
<li>A single line block that is not surrounded with any other body element, except
for white spaces, block tails and comments;</li>
<li>A multi-line block that is not surrounded with any other body element, except
for white spaces, block tails and comments, on the lines where the block head
and tail occur.</li>
</ul>
<p>Any block that does not fall into these categories will be considered an
&quot;embedded&quot; block.</p>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id6">Examples</a></h2>
<p>[PENDING - formatting of the section]</p>
<div class="section" id="stand-alone-single-line-blocks">
<h3><a class="toc-backref" href="#id7">Stand-alone single-line blocks</a></h3>
<pre class="literal-block">
[for (Sequence{false, false, false})][self/][/for]
</pre>
<hr class="docutils" />
<pre class="literal-block">
[if (true)]output[/if]
</pre>
<hr class="docutils" />
<pre class="literal-block">
[for (Sequence{false, false, false})][self/][/for]
</pre>
<hr class="docutils" />
<pre class="literal-block">
[/if]         [if (true)]output[/if]
</pre>
<hr class="docutils" />
<pre class="literal-block">
[/if] [comment .../]  [if (true)]output[/if]
</pre>
</div>
<div class="section" id="embedded-single-line-blocks">
<h3><a class="toc-backref" href="#id8">Embedded single-line blocks</a></h3>
<pre class="literal-block">
Some text[for (Sequence{false, false, false})]output[/for]
</pre>
<hr class="docutils" />
<pre class="literal-block">
[if (true)]output[/if] and some text
</pre>
<hr class="docutils" />
<pre class="literal-block">
[for (Sequence{false, false, false})]   [self/][/for] and some text.
</pre>
</div>
<div class="section" id="stand-alone-multi-line-blocks">
<h3><a class="toc-backref" href="#id9">Stand-alone multi-line blocks</a></h3>
<pre class="literal-block">
[for (Sequence{false, false, false})]
    [self/]
[/for]
</pre>
<hr class="docutils" />
<pre class="literal-block">
[if (true)]output
[/if]
</pre>
<hr class="docutils" />
<pre class="literal-block">
[if (true)]
    output[/if]
</pre>
<hr class="docutils" />
<pre class="literal-block">
[comment]Generate booleans [/comment][for (Sequence{false, false, false})]
    [self/][/for]
</pre>
<hr class="docutils" />
<pre class="literal-block">
[for (Sequence{false, false, false})]
[self/]
[/for]
</pre>
</div>
<div class="section" id="embedded-multi-line-blocks">
<h3><a class="toc-backref" href="#id10">Embedded multi-line blocks</a></h3>
<pre class="literal-block">
text[for (Sequence{false, false, false})]
    [self/]
[/for]
</pre>
<hr class="docutils" />
<pre class="literal-block">
[if (true)]
    output[/if] text
</pre>
</div>
</div>
</div>
<div class="section" id="identifying-body-element-boundaries">
<h1><a class="toc-backref" href="#id11">Identifying Body Element Boundaries</a></h1>
<div class="section" id="block-body">
<h2><a class="toc-backref" href="#id12">Block Body</a></h2>
<blockquote>
<dl class="docutils">
<dt><strong>Single-line block</strong></dt>
<dd>Body starts after the closing bracket of the block head and ends before the
starting bracket of the block tail.</dd>
<dt><strong>Multi-line block</strong></dt>
<dd>If the closing bracket of the block head is directly followed by a new line,
the block's body starts at the beginning of the next line after the block head.
Otherwise the block's body starts after the closing bracket of its head.
The body ends before the starting bracket of the block tail, be it directly
preceded by a new line or not.</dd>
<dt><strong>Special handling of &quot;Template&quot; blocks</strong></dt>
<dd>If the last characters preceding the starting bracket of the block tail is a
new line followed by optional white spaces, the template body ends before the
last new line character preceding its tail.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="static-text">
<h2><a class="toc-backref" href="#id13">Static Text</a></h2>
<p>We need to define the concept of line relevance to properly identify these
boundaries. For this purpose, we will describe as &quot;white spaces&quot; the white
space characters contained in a static text, whatever their position in the
text.</p>
<p>A line is considered &quot;relevant&quot; if it contains anything else than white
spaces, block head, block tail and comment.
Note, however, that lines consisting of white spaces <em>only</em> are also considered
relevant.</p>
<ul class="simple">
<li>If a static text is entirely located on a non relevant line, it does not
produce any text.</li>
<li>If a static text starts on a non relevant line, all characters located on this
line are ignored and the static text is considered to start with the character
after its very first new line character.</li>
<li>If a static text ends on a non relevant line, all characters located on this
line are ignored and the static text is considered to end with the character
before its very last new line character.</li>
<li><em>Special handling of static text following a «&nbsp;protected area&nbsp;» block:</em>
all white spaces following a protected area tail are retained, including the
new line character.
The static text then starts right after the closing bracket of the protected
area tail.</li>
</ul>
</div>
</div>
<div class="section" id="rules">
<h1><a class="toc-backref" href="#id14">Rules</a></h1>
<p>Considering the boundaries outlined in section
<a class="reference internal" href="#identifying-body-element-boundaries">Identifying Body Element Boundaries</a> above, the text production rules stand
as follows:</p>
<ul class="simple">
<li>The text produced by the execution of expressions is output as is;</li>
<li>The text produced by the execution of static text is output as is;</li>
<li>Comments do not produce any text;</li>
<li>Each line of the text produced by a template invocation will be indented to
match the indentation of the line sporting the invocation;</li>
<li>The text produced by the execution of embedded blocks, be they multi-line
blocks or single line blocks, is output as is along with all text produced by
the surrounding body elements.</li>
<li>The text produced by the execution of stand-alone, single line blocks is
output as is. White spaces located before and after the block are retained;</li>
<li>The text produced by the execution of stand-alone, multi-line blocks will be
output as is considering the aforementioned boundaries: if the very first
character of the block body is a new line, it is ignored.
Please note that if a stand-alone, multi-line block doesn't produce any text,
not even a new line character will be present in the resulting text.</li>
</ul>
</div>
<div class="section" id="id1">
<h1><a class="toc-backref" href="#id15">Examples</a></h1>
<p>[PENDING - formatting of the section]</p>
<p>In the following examples, invisible characters have been materialized:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr><td>·</td>
<td>indicates a space character</td>
</tr>
<tr><td>↪</td>
<td>indicates a horizontal tab character</td>
</tr>
<tr><td>¶</td>
<td>indicates a carriage return</td>
</tr>
</tbody>
</table>
<div class="section" id="blocks">
<h2><a class="toc-backref" href="#id16">Blocks</a></h2>
<div class="section" id="embedded-blocks">
<h3><a class="toc-backref" href="#id17">Embedded Blocks</a></h3>
<p>The template code:</p>
<blockquote>
<tt class="docutils literal">Some</tt> · <tt class="docutils literal">text</tt> · <tt class="docutils literal">[for</tt> · <tt class="docutils literal">(Sequence{false,</tt> ·
<tt class="docutils literal">false,</tt> · <tt class="docutils literal">false})</tt> · <tt class="docutils literal">separator</tt> · <tt class="docutils literal">('</tt> ·
<tt class="docutils literal">-</tt> · <tt class="docutils literal"><span class="pre">')]output[/for]</span></tt></blockquote>
<p>produces the following result:</p>
<blockquote>
<tt class="docutils literal">Some</tt> · <tt class="docutils literal">text</tt> · <tt class="docutils literal">output</tt> · <tt class="docutils literal">-</tt> · <tt class="docutils literal">output</tt>
· <tt class="docutils literal">-</tt> · <tt class="docutils literal">output</tt></blockquote>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
<tt class="docutils literal">[if</tt> · <tt class="docutils literal"><span class="pre">(true)]output[/if]</span></tt> · <tt class="docutils literal">and</tt> · <tt class="docutils literal">some</tt>
· <tt class="docutils literal">text</tt></blockquote>
<p>produces:</p>
<blockquote>
<tt class="docutils literal">output</tt> · <tt class="docutils literal">and</tt> · <tt class="docutils literal">some</tt> · <tt class="docutils literal">text</tt></blockquote>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
↪ <tt class="docutils literal">[for</tt> · <tt class="docutils literal">(Sequence{false,</tt> · <tt class="docutils literal"><span class="pre">false})]</span></tt> ·
<tt class="docutils literal"><span class="pre">[self/][/for]</span></tt> · <tt class="docutils literal">and</tt> · <tt class="docutils literal">some</tt> · <tt class="docutils literal">text</tt></blockquote>
<p>produces:</p>
<blockquote>
↪ <tt class="docutils literal">false</tt> · <tt class="docutils literal">false</tt> · <tt class="docutils literal">and</tt> · <tt class="docutils literal">some</tt>
· <tt class="docutils literal">text</tt></blockquote>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
<p><tt class="docutils literal">text[for</tt> · <tt class="docutils literal">(Sequence{false,</tt> · <tt class="docutils literal"><span class="pre">false})]</span></tt> ¶</p>
<p>↪ <tt class="docutils literal">[self/]</tt> ¶</p>
<p><tt class="docutils literal">[/for]text</tt></p>
</blockquote>
<p>produces:</p>
<blockquote>
<p><tt class="docutils literal">text</tt> ↪ <tt class="docutils literal">false</tt> ¶</p>
<p>↪ <tt class="docutils literal">false</tt> ¶</p>
<p><tt class="docutils literal">text</tt></p>
</blockquote>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
<p><tt class="docutils literal">text[for</tt> · <tt class="docutils literal">(Sequence{false,</tt> · <tt class="docutils literal"><span class="pre">false})]</span></tt> ¶</p>
<p>↪ <tt class="docutils literal"><span class="pre">output[/for]text</span></tt></p>
</blockquote>
<p>produces:</p>
<blockquote>
<tt class="docutils literal">text</tt> ↪ <tt class="docutils literal">output</tt> ↪ <tt class="docutils literal">outputtext</tt> ¶</blockquote>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id18">Stand-alone single-line blocks</a></h3>
<p>The template code:</p>
<blockquote>
<tt class="docutils literal">[for</tt> · <tt class="docutils literal">(Sequence{false,</tt> · <tt class="docutils literal">false,</tt> ·
<tt class="docutils literal"><span class="pre">false})][self/][/for]</span></tt></blockquote>
<p>produces:</p>
<blockquote>
<tt class="docutils literal">falsefalsefalse</tt></blockquote>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
<tt class="docutils literal">[if</tt> · <tt class="docutils literal"><span class="pre">(true)]output[/if]</span></tt></blockquote>
<p>produces:</p>
<blockquote>
<tt class="docutils literal">output</tt></blockquote>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
↪ <tt class="docutils literal">[for</tt> · <tt class="docutils literal">(Sequence{false,</tt> · <tt class="docutils literal">false,</tt> ·
<tt class="docutils literal"><span class="pre">false})][self/][/for]</span></tt></blockquote>
<p>produces:</p>
<blockquote>
↪ <tt class="docutils literal">falsefalsefalse</tt></blockquote>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
<tt class="docutils literal">[/if]</tt> ↪ ↪ <tt class="docutils literal">[if</tt> · <tt class="docutils literal"><span class="pre">(true)]output[/if]</span></tt></blockquote>
<p>produces:</p>
<blockquote>
↪ ↪ <tt class="docutils literal">output</tt></blockquote>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
<tt class="docutils literal">[/if]</tt> · <tt class="docutils literal">[comment <span class="pre">.../]</span></tt> ↪ <tt class="docutils literal">[if</tt> · <tt class="docutils literal"><span class="pre">(true)]output[/if]</span></tt></blockquote>
<p>produces:</p>
<blockquote>
↪ ↪ <tt class="docutils literal">output</tt></blockquote>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id19">Stand-alone multi-line blocks</a></h3>
<p>The template code:</p>
<blockquote>
<p><tt class="docutils literal">[for</tt> · <tt class="docutils literal">(Sequence{false,</tt> · <tt class="docutils literal">false,</tt> · <tt class="docutils literal"><span class="pre">false})]</span></tt> ¶</p>
<p>↪ <tt class="docutils literal">[self/]</tt> ¶</p>
<p><tt class="docutils literal">[/for]</tt></p>
</blockquote>
<p>produces:</p>
<blockquote>
<p>↪ <tt class="docutils literal">false</tt> ¶</p>
<p>↪ <tt class="docutils literal">false</tt> ¶</p>
<p>↪ <tt class="docutils literal">false</tt> ¶</p>
</blockquote>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
<p><tt class="docutils literal">[if</tt> · <tt class="docutils literal"><span class="pre">(false)]output</span></tt> ¶</p>
<p><tt class="docutils literal">[/if]</tt></p>
</blockquote>
<p>produces an empty chain &quot;&quot;.</p>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
<p><tt class="docutils literal">[if</tt> · <tt class="docutils literal">(true)]</tt> ¶</p>
<p>↪ <tt class="docutils literal"><span class="pre">output[/if]</span></tt></p>
</blockquote>
<p>produces:</p>
<blockquote>
<tt class="docutils literal">output</tt></blockquote>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
<p><tt class="docutils literal">[comment]for</tt> · <tt class="docutils literal"><span class="pre">loop[/comment][for</span></tt> ·
<tt class="docutils literal">(Sequence{false,</tt> · <tt class="docutils literal"><span class="pre">false})]</span></tt> ¶</p>
<p>↪ <tt class="docutils literal">[if</tt> · <tt class="docutils literal">(self)]</tt> ¶</p>
<p>↪ ↪ <tt class="docutils literal">[self/]</tt> ¶</p>
<p>↪ <tt class="docutils literal">[/if]</tt> ¶</p>
<p><tt class="docutils literal">[/for]</tt></p>
</blockquote>
<p>produces an empty chain &quot;&quot;.</p>
<hr class="docutils" />
<p>The template code:</p>
<blockquote>
<p>↪ <tt class="docutils literal">[for</tt> · <tt class="docutils literal">(Sequence{false,</tt> · <tt class="docutils literal">false,</tt> ·
<tt class="docutils literal"><span class="pre">false})]</span></tt> ¶</p>
<p><tt class="docutils literal">[self/]</tt> ¶</p>
<p>↪ <tt class="docutils literal">[/for]</tt> ¶</p>
</blockquote>
<p>produces:</p>
<blockquote>
<p><tt class="docutils literal">false</tt> ¶</p>
<p><tt class="docutils literal">false</tt> ¶</p>
<p><tt class="docutils literal">false</tt> ¶</p>
</blockquote>
</div>
</div>
</div>
<div class="section" id="complete-example">
<h1><a class="toc-backref" href="#id20">Complete Example</a></h1>
<p>[PENDING - write a complete and meaningful generation module highlighting the most frequently used rules]</p>
</div>
</div>
</body>
</html>
