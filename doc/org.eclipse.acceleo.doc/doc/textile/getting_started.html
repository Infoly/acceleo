<?xml version='1.0' encoding='utf-8' ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><p><img align="middle" border="0" src="../images/getting_started/getting_started_banner.png"/></p><h1 id="First_Generator_Module">First Generator Module</h1><table border="0" cellpadding="5" cellspacing="0"><tr><td>Authors</td><td>Laurent Goubet</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td>Laurent Delaigue</td></tr><tr><td>Contact</td><td>laurent.goubet@obeo.fr</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td>laurent.delaigue@obeo.fr</td></tr></table><p>Copyright 2008, 2011 Obeo.</p><h2 id="Introduction">Introduction</h2><p>The aim of this tutorial is to get you started with Acceleo by helping you create your first generation module. For the purpose of this tutorial, we will focus on creating an Acceleo module that generates Java beans from a UML model.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_uml_model_example.png"/></p><h2 id="Use_the_Acceleo_perspective">Use the Acceleo perspective</h2><p>Using the Acceleo perspective will make things easier when working with Acceleo as it provides dedicated views and actions. Furthermore, being on that perspective will promote some menu items so that they are directly accessible instead of being nested within others.</p><p>You can switch to the Acceleo perspective by selecting the <b>Window &gt; Open Perspective &gt; Other...</b> menu and selecting <b>Acceleo</b> in the popup that appears then.</p><p><img align="middle" border="0" src="../images/acceleo_perspective.png"/></p><h2 id="Create_an_Acceleo_Project">Create an Acceleo Project</h2><p>Acceleo Projects are meant to provide you with facilities to write your Acceleo modules. In order to create a new Acceleo project, use the menu item <b>File &gt; New &gt; Acceleo Project</b>.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_acceleo_module_project.png"/></p><p>Choose the name you want for your project (here, we'll go for the default <i>org.eclipse.acceleo.module.sample</i>), then click <b>Next&gt;</b>.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_acceleo_module_project_1.png"/></p><p>This second wizard page allows you to initialize the project by creating one or several Acceleo module files.</p><ul><li>Select the folder in which you want to create the new module file.</li><li>Fill in the module name (we'll leave it as <i>generate</i> in this example).</li><li>Select the metamodel from which your generation module will take its types (in this example, <i>UML</i>).</li><li>Finally, choose the metaclass that will be used to generate the file (in this example, <i>Class</i>). This can be modified later at any time directly in the module files.</li></ul><p>Note: other options are available to initialize the new module with existing content. These will be discussed in detail later.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_acceleo_module_project_2.png"/></p><p>You can create more than one module file in this project by using the "Add" button on the left, we only need one in this example.</p><p>Clicking on finish will create the module file(s), and some files automatically generated from it (more on these below).</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_acceleo_module_project_result.png"/></p><h2 id="The_Acceleo_editor">The Acceleo editor</h2><p>The Acceleo module editor provides the following features:</p><ul><li>Syntax highlighting</li><li>Content assistant (ctrl + space)</li><li>Error detection</li><li>Quick fixes (ctrl + shift + 1)</li><li>Dynamic outline</li><li>Quick outline (ctrl + O)</li><li>Code folding</li><li>Open declaration (either with 'ctrl + left click' or 'F3' on selection)</li><li>Search references (ctrl + shift + G)</li></ul><p><img align="middle" border="0" src="../images/getting_started/getting_started_acceleo_editor.png"/></p><p>For more information about the Acceleo syntax, please read the official OMG specification accessible from <a href="http://www.omg.org/spec/MOFM2T/1.0/">the official MTL Specification</a>.</p><h2 id="Generating_java_beans">Generating java beans</h2><p>We would now like to create a bean for each of the classes defined in our sample model. Here is the code for the module file: </p><pre> [comment encoding = UTF-8 /]
 [module generate('http://www.eclipse.org/uml2/3.0.0/UML')/]
</pre><pre> [template public generate(aClass : Class)]
 [file (aClass.name.concat('.java'), false)]
   public class [aClass.name.toUpperFirst()/] {
   [for (p: Property | aClass.attribute) separator('\n')]
     private [p.type.name/] [p.name/];
   [/for]
</pre><pre>   [for (p: Property | aClass.attribute) separator('\n')]
     public [p.type.name/] get[p.name.toUpperFirst()/]() {
       return this.[p.name/];
     }
   [/for]
</pre><pre>   [for (o: Operation | aClass.ownedOperation) separator('\n')]
     public [o.type.name/] [o.name/]() {
       // TODO should be implemented
     }
   [/for]
   }
 [/file]
 [/template]
</pre><p>As shown below, the content assistant provides choices from the UML metamodel:</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_acceleo_editor_example.png"/></p><p>You can now launch the generation of your Java beans using this generation module. In order to do this, you will have to :</p><p>Right-click on the Acceleo module file (that is, the <i>generate.mtl</i> file) and select <b>Run As &gt; Launch Acceleo Application</b>.</p><p><img align="middle" border="0" src="../images/acceleo_quickstart_launch1.png"/></p><p>The Acceleo launch configuration page opens, and you need to provide it with the sample model and target folder.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_acceleo_module_launch.png"/></p><p>The resulting java file generated by this module file will look like this:</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_acceleo_module_java_result.png"/></p><h2 id="User_code_blocks">User code blocks</h2><p>Acceleo supports two ways of specifying user code blocks in the generated code. User code blocks delimit portions of text that are only generated once, and preserved for subsequent generations. This is very useful in order to allow users to add code in some areas of the generated files while keeping the rest of the file under the control of the generator.</p><p>The first way of specifying user-code blocks is to use the standard <i><a href="protected">(id)</a>...<a href="/protected">/protected</a></i> construct, as shown below (we've also added some queries in there to handle the package structure):</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_acceleo_usercode_1_editor.png"/></p><p>The above module produces the following code:</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_acceleo_usercode_1_generated.png"/></p><p>The second way, which is specific to generators that target the java language, is to add <i>@generated</i> annotations on the javadoc of elements that must be generated. Other elements (those that do not have such annotations in their javadoc, or in which the annotation has been slightly modified (i.e: <i>@generated NOT</i> or <i>@not-generated</i> ... or whatever you fancy)) are considered not to be modified by subsequent generations.</p><p>If a file contains at least one annotation <i>@generated</i>, the merge of the former java file and the newly generated one is delegated to JMerge_. <i>@generated</i> annotations must be added in the javadoc of the relevant java elements. They are <b><i>not</i></b> JDK5 annotations.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_acceleo_usercode_2_editor.png"/></p><p>In both of these examples, the code located in "protected" areas will never be overriden by subsequent generations, be it left as-is or modified by the user outside of the module (directly in the generated file).</p><h2 id="Java_services_wrappers">Java services wrappers</h2><p>We will now add a requirement that java beans should only be generated for Classes that have the <i>Bean</i> stereotype. This coud be done through Acceleo alone, but for the purpose of this tutorial we will use a java service (extension of the language) in order to check whether the stereotype is present on any given Class.</p><p>It is possible to initialize the content of a new Acceleo module file with content that comes from :</p><ul><li>An existing Acceleo module file (a copy of this file is made)</li><li>Some java code that you need to access from your Acceleo templates</li></ul><p>We will detail here the second possibility, which makes it possible to execute standard java code from any Acceleo template or query.</p><p>First, create the Java class we'll use as a service in Acceleo.</p><ul><li>Right-click the <i>org.eclipse.acceleo.module.sample</i> package in the Package Explorer and select <b>New &gt; Class</b></li></ul><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_java_class.png"/></p><ul><li>In the popup that appears, change the <b>Package</b> field to <i>org.eclipse.acceleo.module.sample.services</i> and fill in the <b>name</b> field, we'll call this java Class <i>UML2Services</i> in this tutorial.</li></ul><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_java_class_1.png"/></p><ul><li>Finally, paste in the following code for this class :</li></ul><pre> package org.eclipse.acceleo.module.sample.services;
</pre><pre> import java.util.List;
</pre><pre> import org.eclipse.uml2.uml.Class;
 import org.eclipse.uml2.uml.Stereotype;
</pre><pre> public class UML2Services {
 public boolean hasStereotype(Class clazz, String stereotypeName) {
   List&lt;Stereotype&gt; stereotypes = clazz.getAppliedStereotypes();
     for (Stereotype stereotype : stereotypes) {
       if (stereotype.getName().equals(stereotypeName)) {
         return true;
       }
     }
     return false;
   }
 }
</pre><p>Now, what's left is to call this method from Acceleo. The easiest way to do so is to use the provided wizard.
Right-click the <i>org.eclipse.acceleo.module.sample.services</i> package and select <b>New &gt; Acceleo Module File</b>.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_service_wrapper.png"/></p><p>In the wizard window, enter the relevant information in the fields : select the UML metamodel URI and change the <b><i>name</i></b> field to <i>uml2Services</i>. Then, activate the <b><i>Advanced</i></b> button in order to gain access to the advanced options.</p><p>Tick the <b>Initialize Contents</b> checkbox and select: <b>Create a Java services wrapper</b>. Finally, browse to find the
<i>UML2Services</i> java file.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_service_wrapper_1.png"/></p><p>This creates a new Acceleo Module file that contains a query (one per java method in your java class) whose role is just to delegate its behavior to the java class, thus making it accessible to your templates.</p><p>This is simply achieved thanks to the non-standard ``invoke`` Acceleo operation.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_service_wrapper_2.png"/></p><p>Now to prevent Acceleo from generating files for classes that do not have the <i>Bean</i> stereotype, all that's needed is to import the <i>uml2Services</i> module in the <i>generate</i> module and nest the <i><a href="file">file</a></i> block within an <i><a href="if">if</a></i> block calling this service.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_service_wrapper_3.png"/></p><h2 id="Creating_a_main_module">Creating a main module</h2><p>We recommend not to have multiple modules with an <b>@main</b> annotation, as it complicates the workflow (you have to launch multiple generations to create all needed files). On the contrary, we recommend creating a "main" module which role will be to delegate to all of the modules that will create files. Typically, this module will be placed alone in its own <i>*.main</i> package.</p><p>Let's create this launcher for the beans generation. First, right-click the <i>org.eclipse.acceleo.module.sample</i> package in the Package Explorer and select <b>New &gt; Acceleo Module File</b>.</p><p>We will need to change all default information. First, append '*/main*' at the end of the <b>parent folder</b> field. Then, give a meaningful name for this module (<i>umlToBeans</i> in this example) and set its metamodel appropriately. As we generate on UML, we will also change the root type of our generation to *Package* (the root of our UML model). We will also untick <b>This will generate a file</b> and tick <b>Create a main annotation</b> in the advanced options.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_main_module.png"/></p><p>Since this module contains a <b>@main</b> annotation, we will need to export its containing package (so that other Eclipse plugins may launch the generation). For this, open the <b><i>META-INF/MANIFEST.MF</i></b> file of your project, go to its <b><i>Runtime</i></b> tab, click <b>Add</b> and select the <i>org.eclipse.acceleo.module.sample.main</i> package. The tab should look like this when you are done :</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_export_main_package.png"/></p><p>Now, paste the following code in your <i>umlToBeans</i> module :</p><pre> [comment encoding = UTF-8 /]
 [module umlToBeans('http://www.eclipse.org/uml2/3.0.0/UML')/]
</pre><pre> [import org::eclipse::acceleo::module::sample::files::generate /]
</pre><pre> [template public umlToBeans(aPackage : Package)]
 [comment @main /]
 [for (aClass : Class | aPackage.packagedElement-&gt;filter(Class))]
 	[aClass.generate()/]
 [/for]
 [/template]
</pre><p>And that's it! you can now launch this main module in order to generate java beans from any UML model. Simply right click the <i>umlToBeans.mtl</i> file, select <b>Run As &gt; Launch Acceleo Application</b> and select the model from which to generate and the target folder before hitting the *Run* button.</p><h2 id="Creating_a_UI_launcher">Creating a UI launcher</h2><p>Now that your generation modules are ready, you may want to have some wizards to launch the generation from within Eclipse. You can use the generated java launcher in a manually coded action, but you can also use the <b><i>New Acceleo UI project</i></b> wizard. This wizard will create a new Eclipse project which will allow you to launch the generation with a right-click action on any appropriate model.</p><p>First, right click on your Acceleo project (<i>org.eclipse.acceleo.module.sample</i>) then select *New &gt; Acceleo UI Launcher Project*.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_module_ui_project.png"/></p><p>Fill in the desired name for this project, then click next.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_module_ui_project_1.png"/></p><p>Select the generator project as referenced project, then click next.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_module_ui_project_2.png"/></p><p>Finally, enter the model filename filter (files for which the generation action must be proposed on ricght-clicks, <i>*.uml</i> in our example), and the java code for the target folder (leave it as-is to generate the code in the <i>src-gen</i> folder of the project containing the right-clicked model).</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_module_ui_project_3.png"/></p><p>The wizard will create a new plugin with all the necessary code to display a new action for the selected model
file that will generate code in the specified folder. The screenshot below shows the result of this plugin, a
<b>Generate Uml To Beans</b> action on the *.uml* files.</p><p><img align="middle" border="0" src="../images/getting_started/getting_started_new_module_ui_project_result.png"/></p></body></html>